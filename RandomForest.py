import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import ConfusionMatrixDisplay, confusion_matrix
from sklearn.model_selection import train_test_split
import matplotlib.pyplot as plt

# Cargar los datos del archivo CSV
data = pd.read_csv('APT-FIN/resultadosTotales.csv')

# Separar los atributos (X) y las etiquetas (y)
X = data.iloc[1:, 1:-1]  # Todas las columnas excepto la última y la primera
y = data.iloc[1:, -1]   # Última columna

# Dividir los datos en conjuntos de entrenamiento y prueba
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.3, random_state=1121218
)

# Entrenar un clasificador Random Forest
rf = RandomForestClassifier()
_ = rf.fit(X_train, y_train)

# Realizar predicciones en el conjunto de prueba
y_pred = rf.predict(X_test)

# Crear la matriz de confusión y visualizarla
fig, ax = plt.subplots(figsize=(8, 5))
cmp = ConfusionMatrixDisplay(
    confusion_matrix(y_test, y_pred),
    display_labels=y.unique().astype(str)
)

cmp.plot(ax=ax)
plt.show()
